{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","debounce","NegociacaoController","constructor","$","document","querySelector","bind","Object","assign","_inputData","_inputQuantidade","_inputValor","_service","_negociacoes","_mensagem","_init","dao","negociacoes","listaTodos","map","adiciona","x","err","texto","message","event","preventDefault","negociacao","_criarNegociacao","_limpaFormulario","console","log","apaga","apagaTodos","esvazia","importa","obterNegociacoesDoPeriodo","filter","getArray","some","novaNegociacao","equals","negociacaoExistente","value","focus","Date","paraData","parseInt","parseFloat"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind, debounce } from '../util/index.js';\n\nexport class NegociacaoController {\n    constructor() {\n        let $ = document.querySelector.bind(document);\n        Object.assign(this, {\n            _inputData: $('#data'),\n            _inputQuantidade: $('#quantidade'),\n            _inputValor: $('#valor'),\n            _service: new NegociacaoService(),\n            _negociacoes: new Bind(\n                new Negociacoes(),\n                new NegociacoesView('#negociacoes'),\n                'adiciona', 'esvazia'\n            ),\n            _mensagem: new Bind(\n                new Mensagem(),\n                new MensagemView('#mensagemView'),\n                'texto'\n            )\n        });\n        this._init();\n    }\n    async _init() {\n        try {\n            const dao = await getNegociacaoDao();\n            const negociacoes = await dao.listaTodos();\n            negociacoes.map( x => this._negociacoes.adiciona(x))\n        } catch(err) {\n            this._mensagem.texto = err.message;\n        }\n    }\n    async adiciona(event) {\n        try {\n            event.preventDefault();\n            const negociacao = this._criarNegociacao();\n            const dao = await getNegociacaoDao();\n            await dao.adiciona(negociacao);\n            this._negociacoes.adiciona(this._criarNegociacao());\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\n            this._limpaFormulario();\n        } catch(err) {\n            console.log(err);\n            this._mensagem.texto = err.message;\n        }\n    }\n    async apaga() {\n        try {\n            const dao = await getNegociacaoDao();\n            await dao.apagaTodos(),\n            this._negociacoes.esvazia();\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\n        }\n        catch(err) {\n            this._mensagem.texto = err;\n        }\n    }\n    @debounce(1500)\n    async importa() {\n        try {\n            const negociacoes = await this._service.obterNegociacoesDoPeriodo();\n            negociacoes.filter(novaNegociacao =>\n                !this._negociacoes.getArray()\n                .some(negociacaoExistente =>\n                    novaNegociacao.equals(negociacaoExistente)\n                )\n            )\n            .map( x => this._negociacoes.adiciona(x))\n            this._mensagem.texto = \"Negociações do período importadas com sucesso!\"\n        } catch (err) {\n        this._mensagem.texto = err;\n    }\n}\n_limpaFormulario() {\n    this._inputData.value = '',\n    this._inputQuantidade.value = 1,\n    this._inputValor.value = '0.00',\n    this._inputData.focus()\n}\n_criarNegociacao() {\n    return new Negociacao(\n        new Date(DateConverter.paraData(this._inputData.value)),\n        parseInt(this._inputQuantidade.value),\n        parseFloat(this._inputValor.value)\n    );\n}\n}\n"]}