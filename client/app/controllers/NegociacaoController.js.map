{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_service","_negociacoes","_mensagem","_init","dao","negociacoes","listaTodos","map","adiciona","x","err","texto","message","event","preventDefault","negociacao","_criarNegociacao","_limpaFormulario","console","log","importa","obterNegociacoesDoPeriodo","filter","getArray","some","novaNegociacao","equals","negociacaoExistente","apaga","apagaTodos","esvazia","value","focus","Date","paraData","parseInt","parseFloat"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind, debounce, controller, bindEvent } from '../util/index.js';\n\n@controller('#data', '#quantidade', '#valor')\nexport class NegociacaoController {\n    constructor(_inputData, _inputQuantidade, _inputValor) {\n        Object.assign(this, {\n            _inputData,\n            _inputQuantidade,\n            _inputValor,\n            _service: new NegociacaoService(),\n            _negociacoes: new Bind(\n                new Negociacoes(),\n                new NegociacoesView('#negociacoes'),\n                'adiciona', 'esvazia'\n            ),\n            _mensagem: new Bind(\n                new Mensagem(),\n                new MensagemView('#mensagemView'),\n                'texto'\n            )\n        });\n        this._init();\n    }\n    async _init() {\n        try {\n            const dao = await getNegociacaoDao();\n            const negociacoes = await dao.listaTodos();\n            negociacoes.map( x => this._negociacoes.adiciona(x))\n        } catch(err) {\n            this._mensagem.texto = err.message;\n        }\n    }\n    @bindEvent('submit', '.form')\n    @debounce()\n    async adiciona(event) {\n        try {\n            event.preventDefault();\n            const negociacao = this._criarNegociacao();\n            const dao = await getNegociacaoDao();\n            await dao.adiciona(negociacao);\n            this._negociacoes.adiciona(this._criarNegociacao());\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\n            this._limpaFormulario();\n        } catch(err) {\n            console.log(err);\n            this._mensagem.texto = err.message;\n        }\n    }\n    @bindEvent('click', '#btnImportar')\n    @debounce()\n    async importa() {\n        try {\n            const negociacoes = await this._service.obterNegociacoesDoPeriodo();\n            negociacoes.filter(novaNegociacao =>\n                !this._negociacoes.getArray()\n                .some(negociacaoExistente =>\n                    novaNegociacao.equals(negociacaoExistente)\n                )\n            )\n            .map( x => this._negociacoes.adiciona(x))\n            this._mensagem.texto = \"Negociações do período importadas com sucesso!\"\n        } catch (err) {\n            this._mensagem.texto = err;\n        }\n    }\n    @bindEvent('click', '#btnApagar')\n    async apaga() {\n        try {\n            const dao = await getNegociacaoDao();\n            await dao.apagaTodos(),\n            this._negociacoes.esvazia();\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\n        }\n        catch(err) {\n            this._mensagem.texto = err;\n        }\n    }\n    _limpaFormulario() {\n        this._inputData.value = '',\n        this._inputQuantidade.value = 1,\n        this._inputValor.value = '0.00',\n        this._inputData.focus()\n    }\n    _criarNegociacao() {\n        return new Negociacao(\n            new Date(DateConverter.paraData(this._inputData.value)),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)\n        );\n    }\n}\n"]}